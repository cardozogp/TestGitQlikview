///$tab Deployment Framework
// First Base Variable Include ,Use relative path to 1.init.qvs
// Contains base searchpath in this container
let vG.BasePath=; 
// Basic search for 1.Init.qvs
$(Include=..\..\..\..\InitLink.qvs);
$(Include=..\..\..\InitLink.qvs);
$(Include=..\..\InitLink.qvs);
$(Include=..\InitLink.qvs);
Exit script when '$(vG.BasePath)'= '';

// Use function: call LoadContainerGlobalVariables('ContainerName',['optional, pick container map from shared folder']) 
// Use for connection to another valid container
call LoadContainerGlobalVariables('Example','ConnString;Config');

// Locale for English
$(Include=$(vG.LocalePath)\1.US.qvs);
// $(Include=$(vG.LocalePath)\2.swe.qvs);

// This Sub will create Calendar based on a date field, all three values are mandatory
// Syntax example in the script:
// call CalendarGen(DateFieldLinkName,DateTableName,CalendarTableName)
// example usage:
// call CalendarGen('DeliveryDate','Orders','Delivery')
$(Include=$(vG.SubPath)\7.CalendarGen.qvs);
///$tab Main

SET HidePrefix = %;

// Single line comment

// Ctrl + E - Editing the script
// Ctrl + R - Reload
// Ctrl + T - Table Viewer
// Ctrl + K + C - Comments high-lighted lines
// Ctrl + K + U - Uncomments high-lighted lines

// Connection string to Northwind Access data source
// use QlikView Deployment Framework Variable $(vG.ConnStringPath)
$(Include=$(vG.ConnStringPath)\0.Example_Access_Northwind-vG.ConfigPath.qvs);
$(Include=$(vG.ExampleConnStringPath)\0.Example_Access_Northwind-vG.ExampleConfigPath.qvs);
///$tab Transactions
Orders:
LOAD CustomerID AS %CustomerID,
    EmployeeID,
    EmployeeID AS EmployeeSalesID,
    Freight,
    Date(OrderDate,'$(DateFormat)') AS OrderDate,
	date(OrderDate+ceil(Rand()*50)) AS DeliveryDate,
    OrderID,
    OrderID AS Orders.OrderID,
    1 AS Orders.Counter
WHERE year(OrderDate)>1990;
    
SQL SELECT *
FROM Orders;

[Order Details]:
LOAD Discount,
    OrderID,
    ProductID,
    Quantity,
    UnitPrice,
    Quantity * UnitPrice * (1 - Discount) AS Sales;
SQL SELECT *
FROM `Order Details`;
///$tab Dimensions
Customer:
LOAD 
	Address,
    City,
    CompanyName AS Customer,
    ContactName,
    Country,
    CustomerID AS %CustomerID,
    Fax,
    Phone,
    PostalCode;
SQL SELECT *
FROM Customers;

Country:
LOAD DISTINCT 
	Country,
	1 AS Country.Counter
RESIDENT Customer;

Shippers:
LOAD CompanyName AS Shipper,
    ShipperID;
SQL SELECT *
FROM Shippers;

Products:
LOAD CategoryID,
    ProductID,
    ProductName,
    QuantityPerUnit,
    SupplierID,
    UnitsInStock,
    UnitsOnOrder;
SQL SELECT *
FROM Products;

Categories:
LOAD CategoryID,
    CategoryName,
    Description;
SQL SELECT *
FROM Categories;

// Creating an calendar index table for selections in the UI 
Calendars:
LOAD * INLINE [
    Calendar
    OrderDate
    DeliveryDate
];
///$tab Calendar Generation
CALL CalendarGen('OrderDate','OrderDate','3', '11/7/1996','8/13/1997');
CALL CalendarGen('DeliveryDate');

 